<!DOCTYPE html><html lang="en-GB" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Unity - Mesh Slicing" /><meta property="og:locale" content="en_GB" /><meta name="description" content="A while ago one of my friends had an idea for a 3D game where you can only see parts of the world at once. Think of a volume, like a cube, within which the world exists and is visible, but outside which there is nothing. The volume exists as a 3D window into the world, so as it moves around in space different parts of the world are revealed to you. Take this horribly-lit screenshot with some terribly-modelled terrain:" /><meta property="og:description" content="A while ago one of my friends had an idea for a 3D game where you can only see parts of the world at once. Think of a volume, like a cube, within which the world exists and is visible, but outside which there is nothing. The volume exists as a 3D window into the world, so as it moves around in space different parts of the world are revealed to you. Take this horribly-lit screenshot with some terribly-modelled terrain:" /><link rel="canonical" href="https://games-hardy.com//posts/unity-mesh-slicing/" /><meta property="og:url" content="https://games-hardy.com//posts/unity-mesh-slicing/" /><meta property="og:site_name" content="James Hardy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-04T17:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Unity - Mesh Slicing" /><meta name="twitter:site" content="@_Nindigo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://games-hardy.com//posts/unity-mesh-slicing/"},"description":"A while ago one of my friends had an idea for a 3D game where you can only see parts of the world at once. Think of a volume, like a cube, within which the world exists and is visible, but outside which there is nothing. The volume exists as a 3D window into the world, so as it moves around in space different parts of the world are revealed to you. Take this horribly-lit screenshot with some terribly-modelled terrain:","url":"https://games-hardy.com//posts/unity-mesh-slicing/","@type":"BlogPosting","headline":"Unity - Mesh Slicing","dateModified":"2021-09-04T17:00:00+01:00","datePublished":"2021-09-04T17:00:00+01:00","@context":"https://schema.org"}</script><title>Unity - Mesh Slicing | James Hardy</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="James Hardy"><meta name="application-name" content="James Hardy"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">James Hardy</a></div><div class="site-subtitle font-italic"><p>Game Systems Engineer, UK</p><p>C++, Java, C#</p></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/mywork/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>MY WORK</span> </a><li class="nav-item"> <a href="/blogs" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/nin1" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/_Nindigo" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jamesmhardy33','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Unity - Mesh Slicing</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Unity - Mesh Slicing</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> James Hardy </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Sep 4, 2021, 5:00 PM +0100" prep="on" > Sep 4 <i class="unloaded">2021-09-04T17:00:00+01:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1126 words">6 min</span></div></div><div class="post-content"><p>A while ago one of my friends had an idea for a 3D game where you can only see parts of the world at once. Think of a volume, like a cube, within which the world exists and is visible, but outside which there is nothing. The volume exists as a 3D window into the world, so as it moves around in space different parts of the world are revealed to you. Take this horribly-lit screenshot with some terribly-modelled terrain:</p><p><img data-proofer-ignore data-src="https://games-hardy.com//assets/posts/2021-09-04-unity-mesh-slicing/comparison.png" alt="mesh-volumes" /></p><p>On the left you can see the whole world, and on the right you can see the whole world as viewed through three cuboid volumes. You can see the terrain and objects have been sliced around each cuboid, so they are only partially visible. Imagine a puzzle where a key is locked inside a box, and the solution is to move one of these windows so you can see the inside, and then fire a grapple across the void to retrieve it. That’s roughly where we were going with this!</p><h2 id="slicing-a-mesh">Slicing a Mesh</h2><hr /><p>To achieve what we wanted, we would need to be able to slice any 3D objects that intersect with the edges of the volume. There’s a few steps to get there, and a few things to understand about meshes, so let’s break the problem down and keep it as simple as possible.</p><p>Firstly, for simplicity, let’s say the volumes are always cuboids. This means for each volume we need to slice an intersecting mesh up to 4 times. Secondly, we need to understand that all meshes are made up of triangles, which are in-turn made up of three vertices each. The steps we will then follow to slice the mesh are:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>For each plane:
    If the mesh intersects this plane:
        For each triangle:
            If the triangle is entirely behind the plane, scrap it
            If the triangle is entirely in-front of the plane, keep it
            If the triangle intersects the plane, slice it
        Fill any visible holes at the intersection plane
</pre></table></code></div></div><p>To check whether the mesh intersects the plane, we can do two things: First, we can do a simple bounding-box check between the plane and a box enclosing the mesh. This is a fast approximate check that allows us to immediately discard anything that’s nowhere near the plane, but doesn’t guarantee that the mesh <em>does</em> intersect the plane. To check that, we’ll need to loop over all of the triangles in the mesh until we find one that intersects. If none intersect, we can skip slicing with this plane.</p><p>If the mesh and plane DO intersect, then we’ve got some work to do. For each triangle, we need to determine whether to slice it, and then perform the slice. To determine whether we need to slice it, we can count how many of that triangle’s points are on each side of the plane (using Unity’s handy Plane.GetSide() method). If all points are on the ‘inside’ (the side that the plane normal is pointing), then we can just keep that triangle. If all the points are on the ‘outside’ (opposite the plane normal), then we can throw that triangle away.</p><p>Things get a bit more complicated when the triangle’s points lie across both sides of the plane. The simplest case is where only one point is on the ‘inside’, as we just need to find the intersection point of the two connected edges with the plane, and replace the other two vertices with these points (essentially clamping the triangle within the plane).</p><p><img data-proofer-ignore data-src="https://games-hardy.com//assets/posts/2021-09-04-unity-mesh-slicing/triangle-1.png" alt="one-point-triangle" /></p><p>If two points are on the inside, and one on the outside, we need to again find the intersection point of the connected edges with the plane. However, we are now left with four points, which requires us to create two triangles. Still fairly straightforward, you just need to be careful of the winding order of your triangles so you’re not accidentally rendering them back-to-front.</p><p><img data-proofer-ignore data-src="https://games-hardy.com//assets/posts/2021-09-04-unity-mesh-slicing/triangle-2.png" alt="two-point-triangle" /></p><p>Just repeat that process for every triangle in the mesh and it’ll be sliced! …Well, almost.</p><p><img data-proofer-ignore data-src="https://games-hardy.com//assets/posts/2021-09-04-unity-mesh-slicing/hollow-mesh.png" alt="hollow-mesh" /></p><h2 id="filling-in-holes">Filling in holes</h2><hr /><p>Obviously, this doesn’t look quite right. The mesh here is a jigsaw-piece (lovingly ripped from Banjo-Kazooie), with a wireframe material on it to show you where all the triangles are, and we’ve sliced it using a plane that’s parallel to its front face. If you look around the remaining faces, you can see where we have clamped some triangles and created new ones to slice the mesh along a plane, so that’s a success at least, but you might also have noticed the massive gaping hole where the front face should be. All of the front faces are behind the slicing plane, so they were all thrown away! We’re going to need to more-or-less recreate them from the remaining vertices that we created along the slicing plane. (The back-face is also missing from this screenshot, but that’s because game engines typically ignore back-facing triangles to save time when rendering - They should never be visible anyway!)</p><p>An important consideration for this particular mesh is that we are left with a convex shape thanks to the ‘tabs’ and ‘slots’ in the jigsaw piece (note: there is no agreed-upon terminology for the innie and outie bits of a jigsaw piece). For this reason, we can’t just find all of the outer-most points on the intersection plane and connect them with triangles. Instead, we can use a method called ‘advancing-front’ to generate the inside mesh. My implementation is a bit cheap and dirty, and works by creating a triangle between the two neighbouring edges with the smallest signed angle repeatedly until the gap is completely filled. By always connecting the edges with the smallest signed angle, we make sure that no triangles are ever generated outside the convex shape. The topology is pretty ugly, but it does the trick:</p><video muted="" autoplay="" loop=""> <source src="/assets/posts/2021-09-04-unity-mesh-slicing/mesh-slicing.webm" type="video/mp4" /> </video><hr /><p>And that’s it! All that’s left to do is pass the resulting mesh into the slicing algorithm for the next 3 planes of the volume, stick it into the Unity MeshFilter, and we’re finished. It would also be good in the future to consider the UV coordinates and normals of the resulting vertices, so textures and lighting look correct.</p><p>There’s a lot of optimisation that can be done with this kind of algorithm - particularly when using C# to make sure heap allocations are kept to a minimum, and being careful with the vector maths to make sure we’re only doing as much work as absolutely necessary. This is also a great candidate for a Unity Entity Component System to parallelise this for every sliced mesh in the scene.</p><p>Unfortunately we could never figure out enough interesting puzzle elements to continue with the game, but I at least found this bit of tech quite interesting!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href="//categories/blogs/" >blogs</a >, <a href="//categories/unity/" >Unity</a ></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/unity/" class="post-tag no-text-decoration" >Unity</a> <a href="//tags/c/" class="post-tag no-text-decoration" >C#</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2" ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/" >CC BY 4.0</a > by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Unity - Mesh Slicing - James Hardy&url=https://games-hardy.com//posts/unity-mesh-slicing/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Unity - Mesh Slicing - James Hardy&u=https://games-hardy.com//posts/unity-mesh-slicing/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Unity - Mesh Slicing - James Hardy&url=https://games-hardy.com//posts/unity-mesh-slicing/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span >Recent Update</span ><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/dark-tower/">Porting a 40-Year-Old Board Game to Unity</a><li><a href="/posts/university/">University - LOD & Tessellation</a><li><a href="/posts/unity-animation-syncing/">Unity - Animation-synced movement</a><li><a href="/posts/runescape/">RuneScape & Old School RuneScape</a><li><a href="/posts/runescape-smooth-movement/">RuneScape - Smooth Movement</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4" ></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/_Nindigo">James Hardy</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/c/">C#</a> <a class="post-tag" href="/tags/game-engine/">game engine</a> <a class="post-tag" href="/tags/unity/">Unity</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/runescape/">RuneScape</a> <a class="post-tag" href="/tags/animation/">animation</a> <a class="post-tag" href="/tags/asm/">asm</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/graphics/">graphics</a> <a class="post-tag" href="/tags/html/">html</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://games-hardy.com/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script>
